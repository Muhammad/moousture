<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Moousture Demo</title>
  <script src="script/mootools.js"></script>
  <script src="../Source/Moousture.js"></script>
  
  
  <style>
    #area{
        border: 1px solid black;
        margin: 5px;
        padding: 5px;
        background-color: #fff;
    }
  </style>
  
  <script>
  
    var selInfo = null;
    var monitor = null;
    var probe = null;
    var recorder = null;
    
    function ccwCircle(error){
		$('errors').set('html', 'Circular gesture error'+error);
    }
    
    function elGest(error){
        $('errors').set('html', 'L gesture error'+error);
    }
	
	function invElGest(error){
		$('errors').set('html', 'reverse L gesture error'+error);
	}
	
	function square(error){
		$('errors').set('html', 'square error'+error);
	}
	
	function startListening(e){
		$('status').set('html', 'Started...');
		$('errors').set('html', '');
		monitor.start(probe, recorder);
		e.stop();
	}
	
	function stopListening(e){
		$('status').set('html', 'Stopped...');
		monitor.stop();
		monitor.match();
		e.stop();
	}
	
	function showOverlay(){
		var elm = new Element('div', {
								'styles': {
									'position': 'absolute',
									'top': 0,
									'left': 0,
									'width': '100%',
									'height': $(document.body).getCoordinates().height,
									'opacity': '0.5',
									'backgroundColor': 'black'
								},
								'id': 'overlayDiv'
							});
							
		$(elm).inject($(document.body));
	}
	
	function hideOverlay(){
		$('overlayDiv').dispose();
	}
	
	function keyPressed(ev){
		$('status').set('html', 'key pressed:'+ev.code);
		if(ev.code === 17){
			if($('overlayDiv'))
				return;
			showOverlay();
			startListening(ev);
		}
	}
	
	function keyReleased(ev){
		$('status').set('html', 'key released:'+ev.code);
		if(ev.code === 17){
			if(!$('overlayDiv'))
				return;
			hideOverlay();
			stopListening(ev);
		}
	}
  
    function domReadyHook(){
        gstr = new Moousture.ReducedLevenMatcher();
    	probe = new Moousture.MouseProbe($(document));
    	recorder = new Moousture.Recorder({maxSteps: 20, minSteps: 2, matcher: gstr});
    	monitor = new Moousture.ManualMonitor(100, 4);
    	gstr.addGesture([3,2,1,0,7,6,5,4], ccwCircle);
		gstr.addGesture([1,3,5,7,3], ccwCircle);
		gstr.addGesture([2,0,4,6], square);
        gstr.addGesture([2,0], elGest);
		gstr.addGesture([2,4], invElGest);
        
		$(document).addEvent('mousedown', startListening );
		$(document).addEvent('mouseup', stopListening );
		
		$(document).addEvent('keydown', keyPressed);
		$(document).addEvent('keyup', keyReleased);
    }
    window.addEvent( 'domready', domReadyHook );
  </script>
</head>


<body>

<div id="status">Doing...</div>
<div id="errors"></div>

</body>
</html>
	